<div class="dark:border-primary-darker flex items-center justify-between border-b px-4 py-4 lg:py-6">
  <h1 class="text-2xl font-semibold flex-grow">{{ 'pages.appmarket.install.title' | translate }}: {{ app?.name }}</h1>
  <a
    class="hover:bg-primary-dark focus:ring-primary dark:focus:ring-offset-dark rounded-md bg-green-700 px-4 py-2 text-sm text-white focus:outline-none focus:ring focus:ring-offset-1 focus:ring-offset-white mx-2"
    [routerLink]="['../../']"
  >
    {{ 'pages.appmarket.title' | translate }}
  </a>
  <a
    class="hover:bg-primary-dark focus:ring-primary dark:focus:ring-offset-dark rounded-md bg-green-700 px-4 py-2 text-sm text-white focus:outline-none focus:ring focus:ring-offset-1 focus:ring-offset-white"
  >
    {{ 'common.refresh' | translate }}
  </a>
</div>

<form [formGroup]="appInstallForm">
  <div class="flex flex-col-reverse xl:flex-row p-1 xs:p-2 sm:p-2 md:p-4 gap-3">
    <div class="w-full">
      <div class="mt-3 dark:bg-darker flex flex-col rounded-md bg-white p-10">
        <form [formGroup]="appInstallForm">
          <div class="flex flex-col mt-3">
            <h5>{{ 'pages.appmarket.install.clusters' | translate }}</h5>
            <p-dropdown
              [options]="clusters$ | async"
              placeholder="{{ 'pages.appmarket.install.clustersPlaceholder' | translate }}"
              optionLabel="clusterName"
              [showClear]="true"
              formControlName="cluster"
              [filter]="true"
              [editable]="true"
              filterBy="clusterId"
              (onChange)="clusterSelected($event)"
            >
              <ng-template let-cluster pTemplate="item">
                <div class="flex flex-col justify-stretch w-[500px]">
                  <span class="text-lg">{{ cluster?.clusterName }} </span>
                  <span class="text-sm">{{ 'pages.appmarket.install.clusterid' | translate }}: {{ cluster?.clusterId }}</span>
                  <span class="text-sm">{{ 'pages.appmarket.install.workspace' | translate }}: {{ cluster?.workspace }}</span>
                </div>
              </ng-template>
            </p-dropdown>
            <span
              *ngIf="appInstallForm.get('cluster').touched && appInstallForm.get('cluster').dirty && appInstallForm.get('cluster').errors"
              class="text-red-400"
              >{{ 'pages.appmarket.install.clusterError' | translate }}</span
            >
          </div>
          <div class="flex flex-col mt-3">
            <h5>{{ 'pages.appmarket.install.namespaces' | translate }}</h5>
            <p-dropdown
              [options]="namespaces$ | async"
              placeholder="{{ 'pages.appmarket.install.namespacesPlaceholder' | translate }}"
              optionLabel="metadata.name"
              [showClear]="true"
              formControlName="namespace"
              [filter]="true"
              [editable]="true"
              filterBy="metadata.name"
              (onChange)="namespaceSelected($event)"
            >
              <ng-template let-namespace pTemplate="item">
                <div class="flex flex-col justify-stretch w-[500px]">
                  <span class="text-lg">{{ namespace?.metadata?.name }} </span>
                </div>
              </ng-template>
            </p-dropdown>
            <span
              *ngIf="appInstallForm.get('namespace').touched && appInstallForm.get('namespace').dirty && appInstallForm.get('namespace').errors"
              class="text-red-400"
              >{{ 'pages.appmarket.install.namespaceError' | translate }}</span
            >
          </div>
          <div class="mt-3">
            <div class="w-full h-[500px]">
              <h5>{{ 'pages.appmarket.install.valuesOverride' | translate }}</h5>
              <div class="flex flex-col h-full">
                <ngx-monaco-editor
                  [options]="editorOptions"
                  [(ngModel)]="code"
                  [ngModelOptions]="{ standalone: true }"
                  class="h-[1000px] w-full flex-grow"
                ></ngx-monaco-editor>
              </div>
            </div>
          </div>
          <div class="mt-5 flex">
            <button
              [disabled]="!appInstallForm?.valid"
              (click)="installApp()"
              class="hover:bg-primary-dark focus:ring-primary dark:focus:ring-offset-dark rounded-md bg-green-700 px-4 py-2 text-sm text-white focus:outline-none focus:ring focus:ring-offset-1 focus:ring-offset-white disabled:bg-gray-500 disabled:hover:bg-gray-800"
            >
              {{ 'pages.appmarket.install.submit' | translate }}
            </button>

            <button
              (click)="reset()"
              class="hover:bg-primary-lighter focus:ring-primary dark:focus:ring-offset-dark ml-3 rounded-md bg-neutral-500 px-4 py-2 text-sm text-white focus:outline-none focus:ring focus:ring-offset-1 focus:ring-offset-white"
            >
              {{ 'common.reset' | translate }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</form>
<p-toast></p-toast>
